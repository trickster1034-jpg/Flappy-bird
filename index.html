<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Dino</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <style>
    body { margin: 0; background: #222; overflow: hidden; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
    #game-container { position: relative; width: 360px; height: 500px; margin: auto; }
    canvas { background: #70c5ce; display: block; touch-action: none; }
    #meme-overlay { 
      position: absolute; top: 100px; left: 50%; transform: translateX(-50%); 
      width: 260px; display: none; border-radius: 10px; z-index: 10;
    }
  </style>
</head>
<body>

<div id="game-container">
  <canvas id="game" width="360" height="500"></canvas>
  <img id="meme-overlay" src="" alt="Meme">
</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const memeImg = document.getElementById("meme-overlay");

  const pipeImg = new Image(); pipeImg.src = "pipe.png";
  const birdImg = new Image(); birdImg.src = "bird.png";
  const bgImg = new Image();   bgImg.src = "bg.png";

  const flapSound = new Audio("flap.mp3");
  let endSound = new Audio();

  let birdX = 50, birdY = 250, birdV = 0;
  let score = 0, frame = 0, bgX = 0;
  let pipes = [], gameStarted = false, gameOver = false, gameWon = false;
  let gamePhase = 1, showScoreboard = false, endTriggered = false, showSkip = false;
  
  const VISUAL_WIDTH = 100;
  let speedMult = 1;

  let highScore = localStorage.getItem("highScore") || 0;
  let deaths = localStorage.getItem("totalDeaths") || 0;
  let lastTap = 0, tapCount = 0, effectT = 0;

  function doTap() {
    if (gameOver || gameWon) {
      if (showScoreboard) location.reload();
      else if (showSkip) showScoreboard = true;
      return;
    }
    if (!gameStarted) { gameStarted = true; return; }
    flapSound.currentTime = 0; flapSound.play().catch(()=>{});
    let now = Date.now();
    if (now - lastTap < 300) tapCount++; else tapCount = 1;
    lastTap = now;
    if (tapCount >= 2) effectT = 15;
    if (gamePhase === 1) birdV = -5;
    else if (birdY >= 420) birdV = -12;
  }

  window.addEventListener("touchstart", (e) => { e.preventDefault(); doTap(); }, {passive: false});
  window.addEventListener("mousedown", doTap);

  function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gamePhase === 1) {
        speedMult = 1 + (score * 0.08); 
        if (gameStarted && !gameOver && frame % 60 === 0 && frame > 0) {
            score++;
            if (score === 10) { 
                gamePhase = 2; 
                pipes = []; 
                birdY = 425; 
            }
        }
    } else {
        speedMult = 1;
    }

    if (bgImg.complete && bgImg.width > 0) {
      if (gameStarted && !gameOver && !game
